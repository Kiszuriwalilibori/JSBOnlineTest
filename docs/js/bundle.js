!function e(t,o,s){function r(i,a){if(!o[i]){if(!t[i]){var c="function"==typeof require&&require;if(!a&&c)return c(i,!0);if(n)return n(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var d=o[i]={exports:{}};t[i][0].call(d.exports,(function(e){return r(t[i][1][e]||e)}),d,d.exports,e,t,o,s)}return o[i].exports}for(var n="function"==typeof require&&require,i=0;i<s.length;i++)r(s[i]);return r}({1:[function(e,t,o){t.exports={name:{getSurname:function(e){const t=function(e){return e.lastIndexOf(" ")};return-1===t(e)?e:e.slice(t(e)+1)},getFirstname:function(e){const t=function(e){return e.lastIndexOf(" ")};return-1===t(e)?e:e.slice(0,t(e))},processedFirstName:function(e){return"By "+this.getFirstname(e)}}}},{}],2:[function(e,t,o){const s=e("./commonJS.js");var{showError:r}=e("./showError");class n{constructor(){this._events={}}on(e,t){return(this._events[e]||(this._events[e]=[])).push(t),this}emit(e,t){(this._events[e]||[]).slice().forEach(e=>e(t))}}class i{constructor(e,t){this.data=e,this.location=t}create(){this.location.style.display="none";const e=document.getElementById("book_template").content.querySelector("li"),t=document.getElementById("separator_template").content.querySelector("li");this.data.length>0&&this.data.forEach((o,r)=>{r+=1;const n=document.importNode(e,!0);n.dataset.number=r.toString(),n.querySelector("a").dataset.href=o.cover.large||"",n.querySelector("img").onload=function(){n.classList.add("activated")},n.querySelector("img").src=o.cover.small||"",n.querySelector("img").alt="cover of book"+o.title||"",n.querySelector(".book__title").textContent=o.title||"",n.querySelector(".author__firstname").textContent="By "+s.name.getFirstname(o.author)||"",n.querySelector(".author__surename").textContent=s.name.getSurname(o.author)||"",n.querySelector(".bookInfo__release-date").textContent=" "+o.releaseDate||"",n.querySelector(".bookInfo__pages").textContent=" "+o.pages||"",n.querySelector(".bookInfo__shop").href=o.link||"",this.location.appendChild(n),r%3==0&&this.location.appendChild(document.importNode(t,!0))}),this.location.style.display="flex"}clear(){for(this.location.style.display="none";this.location.lastChild;)this.location.removeChild(this.location.lastChild);return this.location.style.display="flex",this}}class a{constructor(e,t){this.func=t,this.emptyQuery={filter:null,sort:null},Array.isArray(e)?(console.log("dane from Books",e),this.basicBooks=e,this.processedBooks=e,this.query=this.emptyQuery):(this.basicBooks=e.basicBooks,this.processedBooks=e.processedBooks,this.query=e.query)}clearQuery(){this.query=this.emptyQuery}updateQuery(e){this.query=e}filtrate(){const e=Number(this.query.filter);if(null===e)this.processedBooks=this.basicBooks;else{const t=function(t){return t.pages>e};this.processedBooks=this.basicBooks.filter(t)}return this}sort(){if(null===this.query.sort||0===this.processedBooks.length);else{const e={pages:function(e,t){return e.pages-t.pages},releaseDate:function(e,t){const o=function(e){return e.releaseDate.split("/")},s=function(e){return e[1].concat(e[0])};return Number(s(o(e)))-Number(s(o(t)))},author:(e,t)=>this.func.getSurname(e.author.toLowerCase())>this.func.getSurname(t.author.toLowerCase())};this.processedBooks.sort(e[this.query.sort])}}processContent(){this.filtrate().sort()}get data(){const e={};return e.basicBooks=this.basicBooks.slice(),e.processedBooks=this.processedBooks.slice(),e.query=Object.assign({},this.query),e}get processedItems(){return this.processedBooks.slice()}}class c extends n{constructor(e,t){super(),this.location=t,this.storageAvailable=Modernizr.sessionstorage,this.create(e)}saveToStorage(){this.storageAvailable&&(sessionStorage.setItem(this.location,JSON.stringify(this.Books.data)),this.saveToStorage=()=>{sessionStorage.setItem(this.location,JSON.stringify(this.Books.data))})}update(e){0===arguments.length?(this.Books.clearQuery(),this.saveToStorage(),this.emit("reset_filters")):JSON.stringify(e)===JSON.stringify(this.Books.query)||(this.Books.updateQuery(e),this.Books.processContent(),this.saveToStorage(),!this.Books.processedItems.length>0&&this.emit("no_books_found"),this.emit("updated",this.Books.data))}getData(){return this.Books.data}getProcessedItems(){return this.Books.processedItems}create(e){this.Books=new a(e,s.name),this.Books.processContent(),this.saveToStorage()}}class l extends n{constructor(e,t){super(),this.nodes=e,this.data=t.getProcessedItems(),this.BooksSection=new i(t.getProcessedItems(),this.nodes.booksContainer),this.showBooks().mountHandlers(this.nodes),this.query=t.getData().query,this.setFilters()}setFilters(){this.nodes.pageQueryInput.value=this.query.filter;const e=document.getElementById(this.query.sort);e&&e.setAttribute("checked",!0)}resetFilters(){this.nodes.resetFilters()}getFilters(){const e={};e.filter=this.nodes.pageQueryInput.value?this.nodes.pageQueryInput.value:null;const t=this.nodes.radio.filter(e=>!!e.checked);return e.sort=t.length>0?t[0].value:null,e}mountHandlers(e){e.resetButton.addEventListener("click",()=>this.emit("reset_filters")),e.form.addEventListener("change",()=>{this.emit("changed_radios",this.getFilters())}),window.addEventListener("keyup",e=>{e.preventDefault(),this.emit("any_key_pressed",e)},!1),e.textInput.addEventListener("keydown",e=>{const t=e.keyCode;if((e.keyCode<48||e.keyCode>57&&e.keyCode<96||e.keyCode>105)&&13!==e.keyCode&&8!==e.keyCode)return e.preventDefault&&e.preventDefault(),!1;13===t&&(e.preventDefault(),this.emit("enter_pressed",this.getFilters()))}),this.mountModalTriggers()}showBooks(){return this.BooksSection.clear().create(),this.emit("booksLoaded"),this}showBookModal(e){const t=document.getElementById("myModal");document.getElementById("book_modal_image").src=e.dataset.href,t.style.display="flex",t.style.visibility="visible",document.getElementById("close").addEventListener("click",e=>this.emit("book_modal_close_clicked",t))}hideModal(e){e.style.display="none"}update(e){this.BooksSection.clear(),this.BooksSection=new i(e.processedBooks,this.nodes.booksContainer),this.BooksSection.create(),this.nodes.pageQueryInput.value=e.query.filter,this.mountModalTriggers()}mountModalTriggers(){Array.from(document.getElementsByClassName("book__cover")).forEach(e=>{e.addEventListener("click",e=>this.emit("image_clicked",e.currentTarget))})}showNoBooksModal(){document.getElementById("error_description").textContent="Nie znaleziono książek spełniających kryteria wyszukiwania";const e=document.getElementById("errorModal");document.getElementById("closeErrorScreen").addEventListener("click",t=>this.emit("error_modal_close_clicked",e)),e.style.display="flex"}}class d{constructor(e,t){this.model=e,this.view=t,this.combineHandlers()}combineHandlers(){h.on("changed_radios",e=>u.update(e)),u.on("loaded",e=>h.update(e)),u.on("updated",e=>h.update(e)),h.on("any_key_pressed",e=>this.AltR(e)),u.on("reset_filters",e=>h.resetFilters(e)),h.on("reset_filters",e=>h.resetFilters(e)),h.on("enter_pressed",e=>u.update(e)),h.on("image_clicked",e=>h.showBookModal(e)),h.on("modal_close_clicked",e=>e.clear()),u.on("no_books_found",e=>h.showNoBooksModal(e)),h.on("no_books_modal_close_clicked",e=>e.clear()),h.on("error_modal_close_clicked",e=>h.hideModal(e)),h.on("book_modal_close_clicked",e=>h.hideModal(e))}AltR(e){e.stopPropagation(),e.preventDefault(),e||(e=window.event),e.isComposing||229===e.keyCode||82===e.which&&h.resetFilters()}}let u,h,m;function y(e,t,o){if(console.log("data from mvc",e),e&&t&&o)try{u=new c(e,t),h=new l(o,u),m=new d(u,h)}catch(e){r(e)}}window.onload=function(){const e=document.getElementsByClassName("initially-invisible");Array.prototype.forEach.call(e,e=>{e.style.visibility="visible"}),function(e,t){console.log(t);const o={booksContainer:document.getElementById("booksContainer"),pageQueryInput:document.getElementById("pageQueryInput"),radio:Array.from(document.getElementById("radioInputs").getElementsByTagName("input")),noBooksScreen:document.getElementById("noBooksModal"),noBooksScreenContent:document.getElementById("noBooksModal-content"),myModal:document.getElementById("myModal"),form:document.getElementById("radioInputs"),textInput:document.getElementById("textInput"),resetButton:document.getElementById("resetButton"),resetFilters(){this.pageQueryInput.value=null,this.radio.forEach(e=>{e.checked=!1})}},s=JSON.parse(sessionStorage.getItem(e));Modernizr.sessionstorage&&s?Modernizr.sessionstorage&&s&&y(s,e,o):function(e,t,o){if(window.Worker){var s=new Worker("./js/fetchworker.js");s.onmessage=e=>{const s=e.data;s.message?r({message:"Nie udało się pobrać danych ze źródła",stack:"fetchworker.js"}):y(s,t,o)},s.postMessage(e)}else!async function(e,t,o){try{const s=await fetch(e);y(await s.json(),t,o)}catch(e){r(e)}}(e,t,o)}(t,e,o)}("localBooks","https://learning.oreilly.com/api/v2/search/?query=js")}},{"./commonJS.js":1,"./showError":3}],3:[function(e,t,o){t.exports={showError:function(e){document.getElementById("error_description").textContent=e.message,document.getElementById("error_location").innerHTML=e.stack;const t=document.getElementById("errorModal");document.getElementById("closeErrorScreen").addEventListener("click",e=>{var o;(o=t)&&(o.style.display="none")}),t.style.display="flex"}}},{}]},{},[2]);